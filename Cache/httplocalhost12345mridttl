accept-ranges: bytes
access-control-allow-credentials: true
cache-control: public%2C%20max-age%3D0
connection: close
content-length: 1879
content-type: text/turtle%3B%20charset%3DUTF-8
etag: W/%22757-173596a7cb0%22
last-modified: Thu%2C%2016%20Jul%202020%2020%3A56%3A57%20GMT
vary: Origin
x-powered-by: Express

@prefix solid: <http://www.w3.org/ns/solid/terms#> .
@prefix eco: <http://www.w3.org/ns/solid/ecosystem#> .
@prefix acl: <http://www.w3.org/ns/auth/acl#> .
@prefix tree: <http://www.w3.org/ns/shapetree#> .

<#agent>
    a eco:Application ;
    eco:applicationDescription "Health!" ;
    eco:applicationDevelopedBy "HealthDev.co" ;
    eco:authorizationCallback <https://healthpad.example/callback> ;
    eco:applicationAccessSkosIndex <healthpad-skos-index.ttl> ;
    eco:groupedAccessNeeds <#general>, <#med-management> .

<#general>
    a eco:AccessNeedGroup ;
    eco:requestsAccess <#medical-record-r>, <#dashboard-r> ;
    eco:authenticatesAsAgent <acl:Pilot> .

<#med-management>
    a eco:AccessNeedGroup ;
    eco:requestsAccess <#prescriptions-rw> ;
    eco:authenticatesAsAgent <acl:Pilot> .

# "root" rules (referenced by the AccessNeedsGroup)

<#medical-record-r>
    a eco:AccessNeed ; 
    eco:inNeedSet <#general> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <MedicalRecord.jsonld#medicalrecords> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read .
    
<#dashboard-r>
    a eco:AccessNeed ;
    eco:inNeedSet <#general> ;    
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree<http://dashboard.example/shapetrees#dashboards> ;
    eco:recursivelyAuthorize true;
    eco:requestedAccess acl:Read .

# overrides

<#patient-rw>
    eco:inNeedSet <#general>, <#med-management>;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <MedicalRecord.jsonld#patients> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read, acl:Write .

<#prescriptions-rw>
    eco:inNeedSet <#med-management> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <MedicalRecord.jsonld#prescriptions> ;
    eco:recursivelyAuthorize false ;
    eco:requestedAccess acl:Read, acl:Write .

